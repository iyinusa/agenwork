<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Built-in AI APIs Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .success { background-color: #e8f5e8; border-color: #4caf50; }
        .error { background-color: #ffeaea; border-color: #f44336; }
        .warning { background-color: #fff3cd; border-color: #ffc107; }
        .info { background-color: #e3f2fd; border-color: #2196f3; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pass { background: #4caf50; color: white; }
        .status.fail { background: #f44336; color: white; }
        .status.unknown { background: #9e9e9e; color: white; }
    </style>
</head>
<body>
    <h1>Chrome Built-in AI APIs Diagnostic Test</h1>
    
    <div class="section info">
        <h2>System Requirements</h2>
        <ul>
            <li>Chrome 128+ (preferably Chrome Canary/Dev)</li>
            <li>16GB+ RAM</li>
            <li>22GB+ available storage</li>
            <li>Chrome flags enabled OR Origin Trial token</li>
        </ul>
    </div>

    <div class="section">
        <h2>System Information</h2>
        <div id="system-info">Loading...</div>
    </div>

    <div class="section">
        <h2>API Availability Tests</h2>
        <div id="api-tests">
            <p>Click "Run Tests" to check API availability</p>
            <button onclick="runTests()">Run Tests</button>
        </div>
    </div>

    <div class="section">
        <h2>Detailed Diagnostics</h2>
        <button onclick="runDiagnostics()">Run Full Diagnostics</button>
        <div id="diagnostics-results"></div>
    </div>

    <div class="section">
        <h2>Chrome Flags Setup</h2>
        <p>If APIs are not available, try enabling these Chrome flags:</p>
        <ol>
            <li>Open <code>chrome://flags</code></li>
            <li>Search for and enable:
                <ul>
                    <li><code>Enables optimization guide on device</code></li>
                    <li><code>Prompt API for Gemini Nano</code></li>
                    <li><code>Summarization API for Gemini Nano</code></li>
                    <li><code>Writer API for Gemini Nano</code></li>
                    <li><code>Translation API for Gemini Nano</code></li>
                </ul>
            </li>
            <li>Restart Chrome</li>
            <li>Wait for model download (may take time)</li>
        </ol>
    </div>

    <script src="../js/ai-agents.js"></script>
    <script>
        // Display system information
        function displaySystemInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'Chrome Version': getChromeVersion(),
                'Platform': navigator.platform,
                'Memory': navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'Unknown',
                'Online': navigator.onLine,
                'Language': navigator.language
            };

            let html = '<table style="width: 100%;">';
            for (const [key, value] of Object.entries(info)) {
                const status = key === 'Chrome Version' 
                    ? (value >= 128 ? 'pass' : 'fail')
                    : 'unknown';
                html += `<tr>
                    <td><strong>${key}:</strong></td>
                    <td>${value} <span class="status ${status}">${status.toUpperCase()}</span></td>
                </tr>`;
            }
            html += '</table>';
            
            document.getElementById('system-info').innerHTML = html;
        }

        function getChromeVersion() {
            const match = navigator.userAgent.match(/Chrome\/(\d+)/);
            return match ? parseInt(match[1]) : 'Not Chrome';
        }

        // Test API availability
        async function runTests() {
            const resultsDiv = document.getElementById('api-tests');
            resultsDiv.innerHTML = '<p>Running tests...</p>';

            const tests = [
                { name: 'Window AI Object', test: () => 'ai' in window },
                { name: 'Summarizer API', test: () => 'ai' in window && 'summarizer' in window.ai },
                { name: 'Language Model API', test: () => 'ai' in window && 'languageModel' in window.ai },
                { name: 'Writer API', test: () => 'ai' in window && 'writer' in window.ai },
                { name: 'Translator API', test: () => 'ai' in window && 'translator' in window.ai }
            ];

            let html = '<table style="width: 100%;">';
            
            for (const testCase of tests) {
                try {
                    const result = await testCase.test();
                    const status = result ? 'pass' : 'fail';
                    html += `<tr>
                        <td><strong>${testCase.name}:</strong></td>
                        <td>${result ? 'Available' : 'Not Available'} <span class="status ${status}">${status.toUpperCase()}</span></td>
                    </tr>`;
                } catch (error) {
                    html += `<tr>
                        <td><strong>${testCase.name}:</strong></td>
                        <td>Error: ${error.message} <span class="status fail">FAIL</span></td>
                    </tr>`;
                }
            }

            // Test specific API capabilities
            if ('ai' in window && 'summarizer' in window.ai) {
                try {
                    const capabilities = await window.ai.summarizer.capabilities();
                    html += `<tr>
                        <td><strong>Summarizer Capabilities:</strong></td>
                        <td>${JSON.stringify(capabilities)} <span class="status ${capabilities.available !== 'no' ? 'pass' : 'fail'}">${capabilities.available !== 'no' ? 'PASS' : 'FAIL'}</span></td>
                    </tr>`;
                } catch (error) {
                    html += `<tr>
                        <td><strong>Summarizer Capabilities:</strong></td>
                        <td>Error: ${error.message} <span class="status fail">FAIL</span></td>
                    </tr>`;
                }
            }

            html += '</table>';
            resultsDiv.innerHTML = html;
        }

        // Run full diagnostics using AIAgents class
        async function runDiagnostics() {
            const resultsDiv = document.getElementById('diagnostics-results');
            resultsDiv.innerHTML = '<p>Running diagnostics...</p>';

            try {
                const aiAgents = new AIAgents();
                const diagnostics = await aiAgents.getDiagnostics();
                
                resultsDiv.innerHTML = `
                    <h3>Full Diagnostic Results:</h3>
                    <pre>${JSON.stringify(diagnostics, null, 2)}</pre>
                    
                    <h3>Recommendations:</h3>
                    <ul>
                        ${diagnostics.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>Diagnostic Error:</h3>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displaySystemInfo();
        });
    </script>
</body>
</html>